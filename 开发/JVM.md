## 1、JVM和java体系结构

JVM：跨语言的平台

各种语言通过各自的编译器，编译成字节码文件以后符合java虚拟机的规则（只关注字节码文件），都可以；

- JVM虚拟机是一台执行java字节码的虚拟计算机，它拥有独立的运行机制
- JVM平台的各种语言可以共享java虚拟机带来的跨平台性、优秀的垃圾回收机制，以及可靠的即时编译器；
- java技术的核心就是JVM

作用：

java虚拟机就是二进制字节码的运行环境，负责装载字节码到其内部，解释/编译为对应平台上的机器指令执行。每一条java指令，JVM规范中都有详细定义。

特点：

- 一次编译，到处运行
- 自动内存管理
- 自动垃圾回收功能

### 1.1 jvm的架构模型

java编译器输入的指令流基本上是一种基于栈的指令集架构，另一种指令集架构则是寄存器的指令集架构。

- 基于栈式架构的特点

  - 设计的实现更简单，适用于资源受限的系统

  - 避开了寄存器的分配难题：使用零地址指令方式分配

  - 指令流中的指令大部分是零地址指令，其执行过程依赖于操作栈。指令集更小，编译器容易实现

  - 不需要硬件支持，可移植性更好，更好实现快平台

    ​


- 基于寄存器架构的特点
  - 典型的应用是X86的二进制指令集：比如传统的PC以及安卓的Davlik虚拟机
  - 指令集架构则完全依赖硬件，可移植性差
  - 性能优秀，执行更高效
  - 花费更少的指令去完成一项操作
  - 在大部分情况下，基于寄存器架构的指令集往往都以一地址指令，二地址指令和三地址指令为主，而基于栈式架构的指令集却是以零地址指令为主

**总结**：由于跨平台性的设计，java指令都是根据栈来设计的。不同平台CPU架构不同，所以不能设计为基于寄存器的，优点是跨平台，指令集小，编译器容易实现，缺点是性能下降，实现同样的功能需要更多的指令。

**栈**：跨平台性、指令集下、指令多；执行性能比寄存器差



### 1.2  jvm的生命周期

**虚拟机的启动**：JVM的启动是通过引导类加载器创建一个初始类来完成的，这个类是由虚拟机的具体实现指定的

**虚拟机的执行**：

- 一个运行中的java虚拟机有着一个清晰的任务：执行java程序。
- 程序开始执行时他才运行，程序结束时他就停止
- 执行一个所谓的java程序的时候，真真正正在执行的是一个叫做java虚拟机的进程。

虚拟机的退出：

- 程序正常执行结束
- 程序在执行过程中遇到了异常或错误而异常终止
- 由于操作系统出现错误而导致Java虚拟机进程终止
- 某线程调用runtime类或者system类的exit方法，或者runtime类的halt方法，并且java安全管理器也允许这次exit或者halt操作
- 除此之外，jni规范描述了用jni invocation API来加载或卸载java虚拟机时，java虚拟机的退出情况。